# ğŸš€ Deployment Guide for Render

This guide will help you deploy your NestJS Movie Backend to Render.

## ğŸ”§ Prerequisites

1. **MongoDB Database**: Set up a MongoDB Atlas cluster (free tier available)
2. **Cloudinary Account**: For image/video uploads (free tier available)
3. **Render Account**: Sign up at [render.com](https://render.com)

## ğŸ“‹ Step-by-Step Deployment

### 1. Push Code to GitHub

Make sure your code is pushed to a GitHub repository with the following files:
- âœ… `render.yaml` (configuration file)
- âœ… `.nvmrc` (Node.js version)
- âœ… `package.json` with proper scripts

### 2. Create Render Web Service

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New +"** â†’ **"Web Service"**
3. Connect your GitHub repository
4. Render will automatically detect the `render.yaml` configuration

### 3. Set Environment Variables

In your Render service settings, add these environment variables:

#### Required Variables:
```bash
# MongoDB (Get from MongoDB Atlas)
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/movie_assessment

# Cloudinary (Get from Cloudinary Dashboard)
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret

# Frontend URL (Update after frontend deployment)
FRONTEND_URL=https://your-frontend-app.onrender.com
```

#### Auto-Generated Variables:
- `JWT_SECRET` - Automatically generated by Render
- `NODE_ENV` - Set to "production"
- `PORT` - Set to 3001 (Render will override if needed)
- `JWT_EXPIRES_IN` - Set to "24h"

### 4. MongoDB Atlas Setup

1. Go to [MongoDB Atlas](https://www.mongodb.com/atlas)
2. Create a free cluster
3. Create a database user
4. Get connection string
5. Add your Render IP to Network Access (or use 0.0.0.0/0 for all IPs)

### 5. Cloudinary Setup

1. Go to [Cloudinary](https://cloudinary.com)
2. Sign up for free account
3. Copy credentials from Dashboard:
   - Cloud Name
   - API Key
   - API Secret

### 6. Deploy

1. Click **"Deploy"** in Render
2. Monitor build logs
3. Once deployed, your API will be available at:
   ```
   https://your-service-name.onrender.com/api
   ```

## ğŸ” Verification

Test your deployment:

1. **Health Check**:
   ```bash
   curl https://your-service-name.onrender.com/api/health
   ```

2. **API Documentation**:
   ```
   https://your-service-name.onrender.com/api/docs
   ```

## ğŸš¨ Troubleshooting

### Common Issues:

1. **Build Fails**:
   - Check Node.js version in `.nvmrc`
   - Verify `package.json` scripts
   - Check build logs for missing dependencies

2. **Database Connection Error**:
   - Verify MongoDB URI format
   - Check Network Access in MongoDB Atlas
   - Ensure database user has proper permissions

3. **CORS Issues**:
   - Update `FRONTEND_URL` environment variable
   - Check frontend deployment URL

4. **File Upload Issues**:
   - Verify Cloudinary credentials
   - Check file size limits
   - Ensure proper CORS configuration

### Build Commands Used:
```bash
# Build Command
./render-build.sh

# Start Command  
npm run start:prod
```

### Files for Render Detection:
- âœ… `render.yaml` - Explicit Render configuration
- âœ… `Procfile` - Runtime specification
- âœ… `.nvmrc` - Node.js version (22)
- âœ… `render-build.sh` - Custom build script
- âœ… `package.json` - Node.js project marker

## ğŸ“± Frontend Connection

After backend deployment, update your frontend's API base URL to:
```javascript
const API_BASE_URL = 'https://your-service-name.onrender.com/api';
```

## ğŸ”’ Security Notes

- JWT_SECRET is auto-generated by Render
- Never commit sensitive environment variables
- Use MongoDB Atlas IP whitelist for production
- Enable HTTPS (automatic with Render)

## ğŸ“Š Monitoring

- Check Render dashboard for:
  - Build logs
  - Runtime logs  
  - Performance metrics
  - Error tracking

Your NestJS Movie Backend should now be successfully deployed! ğŸ‰ 